<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Quản lý Đơn hàng</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="container mt-4">

<div class="d-flex gap-2 mb-4 p-3 bg-light rounded shadow-sm">
  <a href="/" class="btn btn-outline-dark">
    <i class="fa-solid fa-home"></i> Trang chủ
  </a>
  <a href="/admin/products" class="btn btn-outline-primary">
    <i class="fa-solid fa-box"></i> Quản lý Sản Phẩm
  </a>
  <a href="/admin/dashboard" class="btn btn-info text-white">
    <i class="fa-solid fa-chart-pie"></i> Xem Top Bán Chạy / Ế
  </a>
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="text-uppercase fw-bold text-success">
    <i class="fa-solid fa-clipboard-list me-2"></i>Quản lý Đơn Hàng
  </h2>
</div>

<!-- Thông báo từ controller (success/error) -->
<div th:if="${success}" class="alert alert-success alert-dismissible fade show mt-3" role="alert">
  <span th:text="${success}"></span>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
<div th:if="${error}" class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
  <span th:text="${error}"></span>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>

<div class="table-responsive shadow-sm rounded">
  <table class="table table-bordered table-hover mb-0">
    <thead class="table-dark text-center">
    <tr>
      <th>Mã Đơn</th>
      <th>Khách hàng</th>
      <th>Ngày đặt</th>
      <th>Tổng tiền</th>
      <th>Trạng thái</th>
      <th>Hành động</th>
    </tr>
    </thead>
    <tbody class="align-middle text-center">
    <tr th:each="order : ${orders}">
      <td class="fw-bold" th:text="'#' + ${order.id}"></td>

      <td th:text="${order.user != null ? order.user.fullName : 'Khách vãng lai'}"></td>

      <td th:text="${#temporals.format(order.createdAt, 'dd-MM-yyyy HH:mm')}"></td>

      <td class="fw-bold text-danger"
          th:text="${#numbers.formatDecimal(order.totalMoney, 0, 'COMMA', 0, 'POINT')} + ' đ'"></td>

      <td>
        <span th:if="${order.status == 'PENDING'}" class="badge bg-warning text-dark">Chờ duyệt</span>
        <span th:if="${order.status == 'APPROVED'}" class="badge bg-primary">Đã duyệt</span>
        <span th:if="${order.status == 'SHIPPED'}" class="badge bg-success">Đã giao</span>
        <span th:if="${order.status == 'CANCELLED'}" class="badge bg-danger">Đã hủy</span>
      </td>
      <td>
        <div class="d-flex justify-content-center gap-1">
          <!-- Duyệt đơn -->
          <form th:if="${order.status == 'PENDING'}"
                th:action="@{/admin/orders/status/{id}(id=${order.id})}" method="post">
            <input type="hidden" name="status" value="APPROVED"/>
            <button type="submit" class="btn btn-success btn-sm" title="Duyệt đơn">
              <i class="fa-solid fa-check"></i>
            </button>
          </form>

          <!-- Giao hàng -->
          <form th:if="${order.status == 'APPROVED'}"
                th:action="@{/admin/orders/status/{id}(id=${order.id})}" method="post">
            <input type="hidden" name="status" value="SHIPPED"/>
            <button type="submit" class="btn btn-info btn-sm text-white" title="Giao hàng">
              <i class="fa-solid fa-truck"></i>
            </button>
          </form>

          <!-- Hủy đơn -->
          <form th:if="${order.status != 'CANCELLED' && order.status != 'SHIPPED'}"
                th:action="@{/admin/orders/status/{id}(id=${order.id})}" method="post">
            <input type="hidden" name="status" value="CANCELLED"/>
            <button type="submit" class="btn btn-danger btn-sm"
                    onclick="return confirm('Hủy đơn này?');" title="Hủy đơn">
              <i class="fa-solid fa-xmark"></i>
            </button>
          </form>
        </div>
      </td>
    </tr>
    </tbody>
  </table>
</div>

</body>
</html>